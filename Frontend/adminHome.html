<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal</title>
     <!-- Favicon -->
     <link href="img/favicon.png" rel="icon">

     <!-- Google Web Fonts -->
     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Inter:wght@700;800&display=swap"
         rel="stylesheet">
 
     <!-- Icon Font Stylesheet -->
     <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
     <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

   
     <!-- Customized Bootstrap Stylesheet -->
     <link href="css/bootstrap.min.css" rel="stylesheet">
 
     <!-- Template Stylesheet -->
     <link href="css/style.css" rel="stylesheet">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
         <style>
             .toast-container {
                 z-index: 1050; /* Ensure it's higher than the navbar */
                 margin-top: 70px; /* Adjust as necessary to ensure visibility */
             }
         </style>
</head>
<body>
      
    <div class="container-xxl bg-white p-0">
    
   

        <!-- Toast Message-->
   <div class="toast-container position-fixed top-3 end-0 p-3" style="z-index: 11">
       <div id="myToast" class="toast align-items-center  bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
           <div class="d-flex">
               <div class="toast-body text-light" id="toastMessage">
                   Hello, world! This is a toast message.
               </div>
               <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
           </div>
       </div>
     </div>



       <!-- Navbar Start -->
       <nav class="navbar navbar-expand-lg bg-white navbar-light shadow sticky-top  p-0" id="navBar">

           <a href="adminHome.html" class="navbar-brand d-flex align-items-center text-center py-0 px-4 px-lg-5">
               <h1 class="m-0 text-primary">JobEntry</h1>
           </a>
           
           <div class="collapse navbar-collapse" id="navbarCollapse">
               <div class="navbar-nav ms-auto p-4 p-lg-0">
                   <a href="adminHome.html" class="nav-item nav-link active">Admin Home</a>
                  
                   
                  
                   <a href="#" class="nav-item nav-link text-primary" id="logOut">LogOut</a>
                  

               </div>
               
           </div>
       </nav>
       <!-- Navbar End -->




       <!-- Search Start -->
       <div class="container-fluid bg-primary mb-5 wow fadeIn" data-wow-delay="0.1s" style="padding: 35px;">
           <div class="container">
               <div class="row g-2">
                   <div class="col-md-10">
                       <div class="row g-2">
                           <div class="col-md-4">
                               <input type="text" id="searchInput" class="form-control border-0" placeholder="Keyword" />
                           </div>
                           <div class="col-md-4">
                               <select class="form-select border-0" id="salaryFilter">
                                   <option value="" selected> Salaries</option>
                                   <option value="0-10000">Less than 10,000</option>
                                   <option value="10000-20000">10,000 - 20,000</option>
                                   <option value="20000-30000">20,000 - 30,000</option>
                                   <option value="30000-40000">30,000 - 40,000</option>
                                   <option value="40000-50000">40,000 - 50,000</option>
                                   <option value="50000-60000">50,000 - 60,000</option>
                                   <option value="60000-70000">60,000 - 70,000</option>
                                   <option value="70000-80000">70,000 - 80,000</option>
                                   <option value="80000-90000">80,000 - 90,000</option>
                                   <option value="90000-100000000">More than 90,000</option>
                               </select>
                           </div>
                           <div class="col-md-4">
                               <select class="form-select border-0" id="locationFilter">
                                   <option value="" selected>All Locations</option>
                                   <option value="New York">New York</option>
                                   <option value="Los Angeles">Los Angeles</option>
                                   <option value="Chicago">Chicago</option>
                                   <option value="Houston">Houston</option>
                                   <option value="Chennai">Chennai</option>
                                   <option value="Banglore">Banglore</option>
                                   <option value="Hyderabad">Hyderabad</option>
                                   <option value="Pune">Pune</option>
                                   <option value="Noida">Noida</option>
                                   <option value="Kochi">Kochi</option>
                               </select>
                           </div>
                       </div>
                   </div>
                   <div class="col-md-2">
                       <button class="btn btn-dark border-0 w-100">Search</button>
                   </div>
               </div>
           </div>
       </div>
       <!-- Search End -->


       <!-- Category Start -->
       <div class="container-xxl py-5">
           <div class="container">
               <h1 class="text-center mb-5 wow fadeInUp" data-wow-delay="0.1s">Search By UserType</h1>
               <div class="row g-4">
                   <div class="col-lg-4 col-sm-6 wow fadeInUp" data-wow-delay="0.1s">
                       <a class="cat-item rounded p-4" href="#tab-1" id="marketingJob">
                           <i class="fa fa-3x fa-mail-bulk text-primary mb-4"></i>
                           <h6 class="mb-3">All Users</h6>
                           <p class="mb-0">123 Vacancy</p>
                       </a>
                   </div>
                   <div class="col-lg-4 col-sm-6 wow fadeInUp" data-wow-delay="0.3s">
                       <a class="cat-item rounded p-4" href="#tab-2"  id="allJobs">
                           <i class="fa fa-3x fa-headset text-primary mb-4"></i>
                           <h6 class="mb-3">All Jobs</h6>
                           <p class="mb-0">123 Vacancy</p>
                       </a>
                   </div>
                   <div class="col-lg-4 col-sm-6 wow fadeInUp" data-wow-delay="0.5s">
                       <a class="cat-item rounded p-4" href="#tab-3" id="humanResourceJob">
                           <i class="fa fa-3x fa-user-tie text-primary mb-4"></i>
                           <h6 class="mb-3">All Applications</h6>
                           <p class="mb-0">123 Vacancy</p>
                       </a>
                   </div>
                  
                  
               </div>
           </div>
       </div>
       <!-- Category End -->


      


       <!-- Jobs Start -->
       <div class="container-xxl py-5">
           <div class="container">
               <h1 class="text-center mb-5 wow fadeInUp" data-wow-delay="0.1s">Job Listing</h1>
               <div class="tab-class text-center wow fadeInUp" data-wow-delay="0.3s">
                   <ul class="nav nav-pills d-inline-flex justify-content-center border-bottom mb-5">
                       <li class="nav-item">
                           <a class="d-flex align-items-center text-start mx-3 ms-0 pb-3 active" data-bs-toggle="pill" id="tab-1-Job"
                               href="#tab-1">
                               <h6 class="mt-n1 mb-0">Users</h6>
                           </a>
                       </li>
                       <li class="nav-item">
                           <a class="d-flex align-items-center text-start mx-3 pb-3" data-bs-toggle="pill"
                               href="#tab-2" id="jobs-2">
                               <h6 class="mt-n1 mb-0">Jobs</h6>
                           </a>
                       </li>
                       <li class="nav-item">
                           <a class="d-flex align-items-center text-start mx-3 me-0 pb-3" data-bs-toggle="pill"
                               href="#tab-3">
                               <h6 class="mt-n1 mb-0">Applications</h6>
                           </a>
                       </li>
                   </ul>
                   <div class="tab-content">
                       <div id="tab-1" class="tab-pane fade show p-0 active">

                       </div>
                       <div id="tab-2" class="tab-pane fade show p-0">

                       </div>
                       <div id="tab-3" class="tab-pane fade show p-0">

                       </div>
                   </div>
               </div>
           </div>
       </div>
       <!-- Jobs End -->


       

       <!-- Footer Start -->
       <div class="container-fluid bg-dark text-white-50 footer pt-5 mt-5 wow fadeIn" data-wow-delay="0.1s">
           <div class="container py-5">
               <div class="row g-5 justify-content-center">
                   <div class="col-lg-6 col-md-6 d-flex justify-content-around">
                       <div>
                           <h5 class="text-white mb-4">Quick Links</h5>
                           <a class="btn btn-link text-white-50" href="about.html">About Us</a>
                           <a class="btn btn-link text-white-50" href="contact.html">Contact Us</a>
                           <a class="btn btn-link text-white-50" href="index.html">Home</a>
                       </div>
                       <div>
                           <h5 class="text-white mb-4">Contact</h5>
                           <p class="mb-2">
                               <i class="fa fa-map-marker-alt me-3"></i>Chennai, Tamil Nadu,
                               India
                           </p>
                           <p class="mb-2">
                               <i class="fa fa-phone-alt me-3"></i>+91 8737848822
                           </p>
                           <p class="mb-2">
                               <i class="fa fa-envelope me-3"></i>aaseaman01@gmail.com
                           </p>
                           <div class="d-flex pt-2">
                               <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-twitter"></i></a>
                               <a class="btn btn-outline-light btn-social" href=""><i
                                       class="fab fa-facebook-f"></i></a>
                               <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-youtube"></i></a>
                               <a class="btn btn-outline-light btn-social" href=""><i
                                       class="fab fa-linkedin-in"></i></a>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
           <div class="container">
               <div class="copyright">
                   <div class="row">
                       <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                           &copy; <a class="border-bottom" href="#">Job Entry</a>, All
                           Right Reserved.

                           Made with ❤ by Aman Agrawal

                       </div>
                       <div class="col-md-6 text-center text-md-end">
                           <div class="footer-menu">
                               <a href="">Home</a>
                               <a href="">Cookies</a>
                               <a href="">Help</a>
                               <a href="">FQAs</a>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>
       <!-- Footer End -->


       <!-- Back to Top -->
       <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <script>
        const token = localStorage.getItem('token');
        document.getElementById('logOut').addEventListener('click',()=>{
    localStorage.clear();
    window.location.href='login.html';
});

    const DisplayUsers= async()=>{
        try{
            const response = await fetch('http://localhost:5190/api/Admin/GetAllUsers',{
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
            }});
            if(!response.ok){
                const errorData= await response.json();
                throw new Error(`Status : ${errorData.statusCode}, message : ${errorData.message}`);

            }
            const data = await response.json();
            console.log(data);
            const Users = document.getElementById('tab-1');
            Users.innerHTML = '';
            data.forEach(user=> {
                if(user.email!=="admin@gmail.com")
            {
                
                const userItem = document.createElement('div');
                userItem.classList.add('job-item', 'p-4', 'mb-4');
                userItem.innerHTML = `
                    <div class="row g-4">
                        <div class="col-sm-12 col-md-8 d-flex align-items-center">
                            <img class="flex-shrink-0 img-fluid border rounded" src="${user.imageUrl}" alt="" style="width: 80px; height: 80px;">
                            <div class="text-start ps-4">
                                <h5 class="mb-3">${user.name}</h5>
                                <span class="text-truncate me-3"><i class="fa-solid fa-envelope text-primary me-2"></i>${user.email}</span>
                                <span class="text-truncate me-3"><i class="fa-sharp fa-solid fa-phone text-primary me-2"></i>${user.contactNumber}</span>
                                <span class="text-truncate me-0"><i class="fa-sharp fa-solid fa-user me-2 text-primary"></i>${user.role}</span>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-4 d-flex flex-column align-items-start align-items-md-end justify-content-center">
                            <div class="d-flex mb-3">
                                
                                <button class="btn btn-primary" onclick="deleteUser(${user.userID})">Delete</button>
                            </div>
                        
                        </div>
                    </div>
                `;
             
                Users.appendChild(userItem);
                }
            });

        }
        catch(err){
            console.log(err.message);
        }
    }

    const displayJobs = async () => {
    try {
        const response = await fetch('http://localhost:5190/api/Application/GetAllJobs', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        });
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(`Status : ${errorData.statusCode}, message : ${errorData.message}`);
        }
        const data = await response.json();
        const Jobs = document.getElementById("tab-2");
        Jobs.innerHTML = ''; // Clear existing jobs before displaying new ones
        data.forEach(job => {
            const jobItem = document.createElement('div');
            jobItem.classList.add('job-item', 'p-4', 'mb-4');
            jobItem.innerHTML = `
                <div class="row g-4">
                    <div class="col-sm-12 col-md-8 d-flex align-items-center">
                        <img class="flex-shrink-0 img-fluid border rounded" src=${job.imageUrl} alt="" style="width: 80px; height: 80px;">
                        <div class="text-start ps-4">
                            <h5 class="mb-3">${job.jobTitle}</h5>
                            <span class="text-truncate me-3"><i class="fa fa-map-marker-alt text-primary me-2"></i>${job.location}</span>
                            <span class="text-truncate me-3"><i class="far fa-clock text-primary me-2"></i>${job.jobType}</span>
                            <span class="text-truncate me-0"><i class="far fa-money-bill-alt text-primary me-2"></i>${job.salary}</span>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-4 d-flex flex-column align-items-start align-items-md-end justify-content-center">
                        <div class="d-flex mb-3">
                            <a class="btn btn-light btn-square me-3" href=""><i class="far fa-heart text-primary"></i></a>
                            <button class="btn btn-primary" onclick="deleteJob(${job.jobID})">Delete</button>
                        </div>
                        <small class="text-truncate"><i class="far fa-calendar-alt text-primary me-2"></i>Date Line: ${formatDate(job.closingDate)}</small>
                    </div>
                </div>
            `;
            Jobs.appendChild(jobItem);
        });
    } catch (err) {
        console.log(err.message);
    }
}

const displayApplications = async () => {
            try {
                const response = await fetch(`http://localhost:5190/api/Admin/GetAllApplications`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                })
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Status : ${errorData.statusCode}, message : ${errorData.message}`);
                }
                const data = await response.json();
                
                const applications = document.getElementById('tab-3');
                applications.innerHTML = ''; // Clear existing jobs before displaying new ones
                data.forEach(app => {
                    const appItem = document.createElement('div');
                    appItem.classList.add('app-item', 'p-4', 'mb-4');
                    appItem.innerHTML = `
              <div class="row g-4">
                    <div class="col-sm-12 col-md-8 d-flex align-items-center">
                        <img class="flex-shrink-0 img-fluid border rounded" src=${app.companyImage} alt="" style="width: 80px; height: 80px;">
                        <div class="text-start ps-4">
                            <h5 class="mb-3">${app.jobSeekerName}</h5>
                            <h6 class="mb-3">${app.jobTitle}</h6>
                            <span class="text-truncate me-3"><i class="fa fa-map-marker-alt text-primary me-2"></i>${app.location}</span>
                            <span class="text-truncate me-3"><i class="far fa-clock text-primary me-2"></i>${app.jobType}</span>
                            <span class="text-truncate me-3"><i class="far fa-money-bill-alt text-primary me-2"></i>${app.salary}</span>
                            <span class="text-truncate me-3"><i class="far fa-check-circle text-primary me-2"></i>${app.status}</span>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-4 d-flex flex-column align-items-start align-items-md-end justify-content-center">
                        <div class="d-flex mb-3">
                           
                            <input type="hidden" id="applicationID" value="${app.applicationID}">
                            <input type="hidden" id="appID" value="${app.jobID}">
                             <button class="btn btn-primary" onclick="delApplication(${app.applicationID})">Delete</button>
                        </div>
                        <small class="text-truncate"><i class="far fa-calendar-alt text-primary me-2"></i>Date Line: ${formatDate(app.applicationDate)}</small>
                    </div>
                </div>
            `;
                    applications.appendChild(appItem);
                })
                
            }
            catch (err) {
                console.log(err.message);
            }
        }

function formatDate(datetimeStr) {
    const date = new Date(datetimeStr);

    const options = { day: 'numeric', month: 'short', year: 'numeric' };
    return date.toLocaleDateString('en-GB', options);
}
const deleteUser= async(userID)=>{

    const confirmDelete = confirm("Are you sure you want to delete the User?");
    if (confirmDelete) {
      try {
          const response = await fetch(`http://localhost:5190/api/User/DeleteUserById?userid=${userID}`, {
              method: 'DELETE',
              headers: {
                  'Authorization': 'Bearer ' + token, // Include token for authentication
                  'Content-Type': 'application/json'
              },
          });
          if (!response.ok) {
              const errorData = await response.json();
              throw new Error(`Status: ${errorData.statusCode}, message: ${errorData.message}`);
          }
          document.getElementById('toastMessage').innerText = 'User Deleted Successfully';
              var toastElement = document.getElementById('myToast');
              var toast = new bootstrap.Toast(toastElement);
              toast.show();
             
              await new Promise(resolve => setTimeout(resolve, 1000));
              await DisplayUsers();
              
            

      } catch (error) {
          console.error('Error deleting profile:', error);
          alert('Error deleting profile. Please try again.');
      }
  }
}
const deleteJob = async (jobId) => {
            try {
                console.log(jobId)
                const response = await fetch(`http://localhost:5190/api/Admin/DeleteJobListingById?jobID=${jobId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                })
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Status : ${errorData.statusCode}, message : ${errorData.message}`);
                }
                const data = await response.json();
                console.log(data);
                document.getElementById('toastMessage').innerText = 'Job Deleted Successfully';
                var toastElement = document.getElementById('myToast');
                var toast = new bootstrap.Toast(toastElement);
                toast.show();
                await new Promise(resolve => setTimeout(resolve, 1000));

                await displayJobs();


            }
            catch (err) {
                console.log(err.message);
            }
        }

        const delApplication = async (appId) => {
  try {
    var response = await fetch(`http://localhost:5190/api/Admin/DeleteApplicationById?applicationId=${appId}`, {
      method: 'DELETE',
      headers: {
        'Authorization': 'Bearer ' + token,
      }
    });
    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(`Status : ${errorData.statusCode}, message : ${errorData.message}`);
    }
    const data = await response.json();
    console.log(data);
    document.getElementById('toastMessage').innerText = "Application Deleted";
    var toastElement = document.getElementById('myToast');
    var toast = new bootstrap.Toast(toastElement);
    toast.show();
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    await displayApplications();
    
  }
  catch (error) {
    console.log(error.message);
  }
}
displayApplications();
displayJobs();
DisplayUsers();
    </script>
</body>
</html>